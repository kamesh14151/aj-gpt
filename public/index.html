<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AJ-GPT</title>
<!-- Embedded AJ Logo as favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23000;stop-opacity:1' /><stop offset='100%25' style='stop-color:%23333;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' fill='url(%23grad)'/><text x='50' y='65' font-family='Arial Black' font-size='45' font-weight='900' text-anchor='middle' fill='white'>AJ</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<style>
:root {
  --primary: #6366f1;
  --secondary: #8b5cf6;
  --accent: #ec4899;
  --aj-yellow: #FFD700;
  --flash-color: #4F46E5;
  --mini-color: #9333EA;
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --border: #334155;
  --hover: #475569;
  --success: #10b981;
  --warning: #f59e0b;
  --error: #ef4444;
  --shadow: rgba(0, 0, 0, 0.25);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --code-bg: #1e293b;
  --code-border: #334155;
  --copilot-bg: #2d3748;
  --copilot-accent: #0078d4;
  --copilot-border: #404040;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  height: 100vh;
  overflow: hidden;
}

/* Splash Screen with CRT Effect */
.splash-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 1;
  transition: opacity 0.5s ease;
  overflow: hidden;
}

/* CRT Effects */
.splash-screen::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    rgba(18, 16, 16, 0) 50%,
    rgba(0, 0, 0, 0.25) 50%
  );
  background-size: 100% 4px;
  z-index: 2;
  pointer-events: none;
}

.splash-screen::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
    ellipse at center,
    rgba(0, 0, 0, 0) 0%,
    rgba(0, 0, 0, 0.4) 100%
  );
  z-index: 1;
  pointer-events: none;
}

.crt-flicker {
  animation: flicker 0.15s infinite alternate;
}

@keyframes flicker {
  0% { opacity: 0.97; }
  100% { opacity: 1; }
}

.splash-screen.fade-out {
  opacity: 0;
  pointer-events: none;
}

.splash-screen.hidden {
  display: none;
}

.splash-logo {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  border-radius: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: 900;
  color: white;
  margin-bottom: 24px;
  box-shadow: 0 0 20px rgba(99, 102, 241, 0.7);
  animation: pulseGlow 2s ease-in-out infinite alternate, crt-flicker 0.15s infinite alternate;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
  z-index: 3;
}

@keyframes pulseGlow {
  0% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.7); }
  100% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.9); }
}

.splash-title {
  font-size: 36px;
  font-weight: 700;
  margin-bottom: 12px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  z-index: 3;
  text-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
  animation: crt-flicker 0.15s infinite alternate;
}

.splash-subtitle {
  font-size: 16px;
  color: var(--text-secondary);
  margin-bottom: 40px;
  z-index: 3;
  animation: crt-flicker 0.15s infinite alternate;
}

.loading-dots {
  display: flex;
  gap: 8px;
  z-index: 3;
}

.loading-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--primary);
  animation: loadingDot 1.4s infinite;
  box-shadow: 0 0 10px rgba(99, 102, 241, 0.7);
}

.loading-dot:nth-child(1) { animation-delay: 0s; }
.loading-dot:nth-child(2) { animation-delay: 0.2s; }
.loading-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes loadingDot {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
  30% { transform: translateY(-20px); opacity: 1; }
}

/* App Container */
.app-container {
  display: flex;
  height: 100vh;
  width: 100%;
}

/* Sidebar */
.sidebar {
  width: 260px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  transition: var(--transition);
  position: relative;
  z-index: 10;
}

.sidebar-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-logo {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 14px;
  color: white;
}

.new-chat-btn {
  flex: 1;
  padding: 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: var(--transition);
}

.new-chat-btn:hover {
  background: var(--hover);
}

.sidebar-search {
  padding: 12px;
}

.search-box {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 8px 12px 8px 36px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  transition: var(--transition);
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
}

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
}

.chat-history {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.chat-history::-webkit-scrollbar {
  width: 4px;
}

.chat-history::-webkit-scrollbar-track {
  background: transparent;
}

.chat-history::-webkit-scrollbar-thumb {
  background: var(--bg-tertiary);
  border-radius: 2px;
}

.chat-history-item {
  padding: 10px 12px;
  margin-bottom: 4px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: var(--transition);
  position: relative;
}

.chat-history-item:hover {
  background: var(--hover);
}

.chat-history-item.active {
  background: var(--primary);
}

.chat-history-title {
  font-size: 14px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 150px;
}

.chat-history-date {
  font-size: 12px;
  color: var(--text-secondary);
}

.chat-delete-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 24px;
  height: 24px;
  border-radius: 4px;
  background: var(--error);
  border: none;
  color: white;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.chat-history-item:hover .chat-delete-btn {
  display: flex;
}

.sidebar-footer {
  padding: 12px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: center;
}

.settings-btn {
  width: 100%;
  padding: 10px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: var(--transition);
}

.settings-btn:hover {
  background: var(--hover);
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Chat Header */
.chat-header {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: center;
  align-items: center;
  background: var(--bg-secondary);
  position: relative;
}

.chat-title-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-title-logo {
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 10px;
  color: white;
}

.chat-title {
  font-size: 16px;
  font-weight: 600;
}

.chat-actions {
  position: absolute;
  right: 24px;
  display: flex;
  gap: 8px;
}

.icon-btn {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
}

.icon-btn:hover {
  background: var(--hover);
  color: var(--text-primary);
}

/* Chat Container */
.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.chat-container::-webkit-scrollbar {
  width: 8px;
}

.chat-container::-webkit-scrollbar-track {
  background: transparent;
}

.chat-container::-webkit-scrollbar-thumb {
  background: var(--bg-tertiary);
  border-radius: 4px;
}

/* Welcome Screen */
.welcome-screen {
  max-width: 680px;
  margin: 0 auto;
  text-align: center;
  padding: 40px 0;
}

.welcome-logo {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: 900;
  color: white;
  margin: 0 auto 24px;
  box-shadow: 0 15px 30px rgba(99, 102, 241, 0.3);
}

.welcome-title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 16px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.welcome-subtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin-bottom: 32px;
}

.example-prompts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 16px;
  margin-top: 32px;
}

.example-prompt {
  padding: 20px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  text-align: left;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.example-prompt::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 0;
}

.example-prompt:hover::before {
  opacity: 0.1;
}

.example-prompt:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}

.example-prompt-content {
  position: relative;
  z-index: 1;
}

.example-prompt-title {
  font-weight: 600;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.example-prompt-icon {
  width: 20px;
  height: 20px;
  color: var(--primary);
}

.example-prompt-desc {
  font-size: 14px;
  color: var(--text-secondary);
}

/* Messages - Copilot Style */
.message {
  display: flex;
  gap: 16px;
  max-width: 800px;
  margin: 0 auto;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  flex-shrink: 0;
  font-size: 12px;
}

.message.user .message-avatar {
  background: var(--primary);
  color: white;
}

.message.ai.grok .message-avatar {
  background: var(--flash-color);
  color: white;
}

.message.ai.gemini .message-avatar {
  background: var(--mini-color);
  color: white;
}

.message-content {
  flex: 1;
  padding: 16px 20px;
  border-radius: 16px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  position: relative;
}

.message.user .message-content {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-color: transparent;
  color: white;
}

/* Copilot-style AI message */
.message.ai .message-content {
  background: var(--copilot-bg);
  border: 1px solid var(--copilot-border);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.message-text {
  font-size: 15px;
  line-height: 1.6;
}

.message-text p {
  margin-bottom: 12px;
}

.message-text p:last-child {
  margin-bottom: 0;
}

.message-text ul, .message-text ol {
  margin-left: 20px;
  margin-bottom: 12px;
}

.message-text a {
  color: var(--copilot-accent);
  text-decoration: none;
}

.message-text a:hover {
  text-decoration: underline;
}

/* Copilot-style follow-up suggestions */
.follow-up-suggestions {
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}

.follow-up-title {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.follow-up-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.follow-up-chip {
  padding: 6px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 16px;
  font-size: 13px;
  color: var(--text-primary);
  cursor: pointer;
  transition: var(--transition);
}

.follow-up-chip:hover {
  background: var(--hover);
  border-color: var(--primary);
}

/* Code blocks - Copilot Style */
.code-block {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  margin: 16px 0;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border-bottom: 1px solid var(--code-border);
}

.code-language {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.code-actions {
  display: flex;
  gap: 8px;
}

.copy-code-btn, .run-code-btn, .preview-btn {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 10px;
  border-radius: 6px;
  transition: var(--transition);
  font-weight: 500;
}

.copy-code-btn:hover, .run-code-btn:hover, .preview-btn:hover {
  background: var(--hover);
  color: var(--text-primary);
  border-color: var(--primary);
}

.code-content {
  padding: 16px;
  overflow-x: auto;
  background: var(--code-bg);
}

.code-content pre {
  margin: 0;
  font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.6;
}

/* Inline code styling */
.message-text code:not([class]) {
  background: var(--bg-tertiary);
  color: var(--aj-yellow);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'JetBrains Mono', 'SF Mono', monospace;
  font-size: 13px;
  border: 1px solid var(--border);
}

.message-actions {
  display: flex;
  gap: 12px;
  margin-top: 12px;
}

.message-action {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  padding: 4px 8px;
  border-radius: 4px;
}

.message-action:hover {
  color: var(--text-primary);
  background: var(--hover);
}

/* Typing Indicator */
.typing-indicator {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  background: var(--copilot-bg);
  border: 1px solid var(--copilot-border);
  border-radius: 16px;
  width: fit-content;
  max-width: 800px;
  margin: 0 auto;
}

.typing-ai-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 10px;
  color: white;
}

.typing-ai-avatar.grok {
  background: var(--flash-color);
}

.typing-ai-avatar.gemini {
  background: var(--mini-color);
}

.typing-dots {
  display: flex;
  gap: 4px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-secondary);
  animation: typingDot 1.4s infinite;
}

.typing-dot:nth-child(1) { animation-delay: 0s; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingDot {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
  30% { transform: translateY(-10px); opacity: 1; }
}

/* Input Area */
.input-area {
  padding: 24px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
}

.input-container {
  max-width: 800px;
  margin: 0 auto;
  position: relative;
}

.input-field {
  width: 100%;
  padding: 16px 50px 16px 20px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 16px;
  resize: none;
  min-height: 56px;
  max-height: 200px;
  transition: var(--transition);
  font-family: inherit;
}

.input-field:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.input-field::placeholder {
  color: var(--text-secondary);
}

.send-button {
  position: absolute;
  right: 12px;
  bottom: 12px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--primary);
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.send-button:hover:not(:disabled) {
  background: var(--secondary);
  transform: scale(1.05);
}

.send-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: scale(1);
}

/* Model Selector */
.model-selector-modal {
  display: none;
  position: absolute;
  top: 60px;
  right: 24px;
  width: 280px;
  background: var(--bg-secondary);
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 10px 25px var(--shadow);
  z-index: 60;
  overflow: hidden;
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.model-modal-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 14px;
}

.model-modal-option {
  padding: 12px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

.model-modal-option:hover {
  background: var(--hover);
}

.model-modal-option.active {
  background: var(--hover);
}

.model-modal-option.active::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--primary);
}

.model-modal-icon {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 12px;
}

.model-modal-info {
  flex: 1;
}

.model-modal-name {
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 14px;
}

.model-modal-desc {
  font-size: 12px;
  color: var(--text-secondary);
}

/* Settings Modal */
.settings-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 100;
  align-items: center;
  justify-content: center;
  padding: 24px;
}

.settings-content {
  background: var(--bg-secondary);
  border-radius: 16px;
  width: 100%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  border: 1px solid var(--border);
}

.settings-header {
  padding: 20px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.settings-title {
  font-size: 20px;
  font-weight: 600;
}

.settings-close {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
}

.settings-close:hover {
  background: var(--hover);
  color: var(--text-primary);
}

.settings-body {
  padding: 20px;
}

.settings-section {
  margin-bottom: 24px;
}

.settings-section-title {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
}

.settings-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}

.settings-item:last-child {
  border-bottom: none;
}

.settings-label {
  font-size: 14px;
}

.settings-control {
  display: flex;
  align-items: center;
  gap: 12px;
}

.toggle-switch {
  position: relative;
  width: 44px;
  height: 24px;
  background: var(--bg-tertiary);
  border-radius: 24px;
  cursor: pointer;
  transition: var(--transition);
}

.toggle-switch.active {
  background: var(--primary);
}

.toggle-switch-handle {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  background: white;
  border-radius: 50%;
  transition: var(--transition);
}

.toggle-switch.active .toggle-switch-handle {
  transform: translateX(20px);
}

.settings-select {
  padding: 6px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text-primary);
  font-size: 14px;
}

.settings-footer {
  padding: 16px 20px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

.settings-button {
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
}

.settings-button-primary {
  background: var(--primary);
  color: white;
}

.settings-button-primary:hover {
  background: var(--secondary);
}

.settings-button-secondary {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.settings-button-secondary:hover {
  background: var(--hover);
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px var(--shadow);
  z-index: 200;
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
  max-width: 90%;
}

.toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.toast.success {
  border-left: 4px solid var(--success);
}

.toast.error {
  border-left: 4px solid var(--error);
}

.toast.info {
  border-left: 4px solid var(--primary);
}

/* Mobile Menu Button */
.mobile-menu-btn {
  display: none;
  position: fixed;
  top: 16px;
  left: 16px;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  color: var(--text-primary);
  z-index: 20;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}

/* Responsive Design */
@media (max-width: 768px) {
  .mobile-menu-btn {
    display: flex;
  }
  
  .sidebar {
    position: fixed;
    left: -260px;
    height: 100%;
    z-index: 50;
    transition: left 0.3s ease;
  }
  
  .sidebar.open {
    left: 0;
  }
  
  .sidebar-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 40;
  }
  
  .sidebar-overlay.show {
    display: block;
  }
  
  .chat-header {
    padding: 16px;
  }

  .chat-title {
    margin-left: 0;
    text-align: center;
  }
  
  .chat-actions {
    right: 16px;
  }

  .chat-container {
    padding: 16px;
  }
  
  .input-area {
    padding: 16px;
  }
  
  .welcome-title {
    font-size: 24px;
  }
  
  .example-prompts {
    grid-template-columns: 1fr;
  }
  
  .model-selector-modal {
    top: 60px;
    right: 16px;
    width: 240px;
  }
  
  .message-content {
    padding: 12px 16px;
  }
  
  .message-text {
    font-size: 15px;
  }
  
  .code-block {
    margin: 8px 0;
  }
  
  .code-content {
    padding: 12px;
    font-size: 13px;
  }
  
  .input-field {
    padding: 14px 50px 14px 16px;
    font-size: 15px;
  }
  
  .send-button {
    width: 28px;
    height: 28px;
  }
  
  .message-avatar {
    width: 28px;
    height: 28px;
  }
  
  .icon-btn {
    width: 28px;
    height: 28px;
  }
  
  .chat-history-item {
    padding: 8px 10px;
  }
  
  .welcome-screen {
    padding: 30px 0;
  }
  
  .example-prompt {
    padding: 16px;
  }
  
  .settings-content {
    max-height: 90vh;
  }
  
  .toast {
    bottom: 80px;
    padding: 10px 16px;
    font-size: 14px;
    max-width: calc(100% - 32px);
  }

  .code-content pre code {
    white-space: pre-wrap;
    word-break: break-word;
  }
  
  .splash-logo {
    width: 100px;
    height: 100px;
    font-size: 40px;
  }
  
  .splash-title {
    font-size: 28px;
  }
}

@media (max-width: 480px) {
  .welcome-logo {
    width: 60px;
    height: 60px;
    font-size: 24px;
  }
  
  .welcome-title {
    font-size: 20px;
  }
  
  .welcome-subtitle {
    font-size: 16px;
  }
  
  .splash-logo {
    width: 80px;
    height: 80px;
    font-size: 32px;
  }
  
  .splash-title {
    font-size: 24px;
  }
}
</style>
</head>
<body>

<!-- Splash Screen with CRT Effect -->
<div class="splash-screen" id="splashScreen">
  <div class="splash-logo">AJ</div>
  <div class="splash-title">AJ-GPT</div>
  <div class="splash-subtitle">Initializing your AI assistant...</div>
  <div class="loading-dots">
    <div class="loading-dot"></div>
    <div class="loading-dot"></div>
    <div class="loading-dot"></div>
  </div>
</div>

<div class="app-container">
  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn" id="mobileMenuBtn">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">AJ</div>
      <button class="new-chat-btn" id="newChatBtn">
        <i class="fas fa-plus"></i> New chat
      </button>
    </div>
    
    <div class="sidebar-search">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" id="searchInput" placeholder="Search conversations...">
      </div>
    </div>
    
    <div class="chat-history" id="chatHistory">
      <!-- Chat history items will be dynamically loaded here -->
    </div>
    
    <div class="sidebar-footer">
      <button class="settings-btn" id="settingsBtn">
        <i class="fas fa-cog"></i> Settings
      </button>
    </div>
  </div>
  
  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="chat-title-container">
        <div class="chat-title-logo">AJ</div>
        <div class="chat-title">AJ-GPT</div>
      </div>
      
      <div class="chat-actions">
        <button class="icon-btn" title="Select AI Model" id="modelSelectBtn">
          <i class="fas fa-robot"></i>
        </button>
        <button class="icon-btn" title="Export Chat" id="exportChatBtn">
          <i class="fas fa-download"></i>
        </button>
        <button class="icon-btn" title="Clear Chat" id="clearChatBtn">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
      <!-- Welcome Screen -->
      <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-logo">AJ</div>
        <h1 class="welcome-title">Welcome to AJ-GPT</h1>
        <p class="welcome-subtitle">Your intelligent AI assistant is ready to help</p>
        
        <div class="example-prompts">
          <div class="example-prompt" onclick="quickPrompt('Explain quantum computing in simple terms')">
            <div class="example-prompt-content">
              <div class="example-prompt-title">
                <i class="fas fa-atom example-prompt-icon"></i>
                Explain quantum computing
              </div>
              <div class="example-prompt-desc">Get a simple explanation of quantum computing concepts</div>
            </div>
          </div>
          <div class="example-prompt" onclick="quickPrompt('Write a Python function to sort a list')">
            <div class="example-prompt-content">
              <div class="example-prompt-title">
                <i class="fab fa-python example-prompt-icon"></i>
                Python sorting function
              </div>
              <div class="example-prompt-desc">Generate code for sorting algorithms with examples</div>
            </div>
          </div>
          <div class="example-prompt" onclick="quickPrompt('Create a workout plan for beginners')">
            <div class="example-prompt-content">
              <div class="example-prompt-title">
                <i class="fas fa-dumbbell example-prompt-icon"></i>
                Beginner workout plan
              </div>
              <div class="example-prompt-desc">Design a comprehensive fitness routine for beginners</div>
            </div>
          </div>
          <div class="example-prompt" onclick="quickPrompt('Explain the theory of relativity')">
            <div class="example-prompt-content">
              <div class="example-prompt-title">
                <i class="fas fa-space-shuttle example-prompt-icon"></i>
                Theory of relativity
              </div>
              <div class="example-prompt-desc">Learn about Einstein's groundbreaking physics theory</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <textarea class="input-field" id="messageInput" placeholder="Message AJ-GPT..." rows="1"></textarea>
        <button class="send-button" id="sendBtn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Model Selector Modal -->
<div class="model-selector-modal" id="modelSelectorModal">
  <div class="model-modal-header">Select AI Model</div>
  <div class="model-modal-option active" data-model="grok" data-name="AJ-GPT Flash">
    <div class="model-modal-icon" style="background: var(--flash-color);">F</div>
    <div class="model-modal-info">
      <div class="model-modal-name">AJ-GPT Flash</div>
      <div class="model-modal-desc">Fast and efficient for most tasks</div>
    </div>
  </div>
  <div class="model-modal-option" data-model="gemini" data-name="AJ-GPT Mini">
    <div class="model-modal-icon" style="background: var(--mini-color);">M</div>
    <div class="model-modal-info">
      <div class="model-modal-name">AJ-GPT Mini</div>
      <div class="model-modal-desc">Compact and resource-friendly</div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="settings-modal" id="settingsModal">
  <div class="settings-content">
    <div class="settings-header">
      <div class="settings-title">Settings</div>
      <button class="settings-close" id="closeSettings">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="settings-body">
      <div class="settings-section">
        <div class="settings-section-title">Appearance</div>
        <div class="settings-item">
          <div class="settings-label">Dark Mode</div>
          <div class="settings-control">
            <div class="toggle-switch active" id="darkModeToggle">
              <div class="toggle-switch-handle"></div>
            </div>
          </div>
        </div>
        <div class="settings-item">
          <div class="settings-label">Typing Animation</div>
          <div class="settings-control">
            <div class="toggle-switch active" id="typingToggle">
              <div class="toggle-switch-handle"></div>
            </div>
          </div>
        </div>
        <div class="settings-item">
          <div class="settings-label">Font Size</div>
          <div class="settings-control">
            <select class="settings-select" id="fontSize">
              <option value="14px">Small</option>
              <option value="16px" selected>Medium</option>
              <option value="18px">Large</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="settings-section">
        <div class="settings-section-title">Chat</div>
        <div class="settings-item">
          <div class="settings-label">Sound Effects</div>
          <div class="settings-control">
            <div class="toggle-switch" id="soundToggle">
              <div class="toggle-switch-handle"></div>
            </div>
          </div>
        </div>
        <div class="settings-item">
          <div class="settings-label">Response Length</div>
          <div class="settings-control">
            <select class="settings-select" id="responseLength">
              <option value="short">Short</option>
              <option value="medium" selected>Medium</option>
              <option value="long">Long</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="settings-footer">
      <button class="settings-button settings-button-secondary" id="resetSettings">Reset to Default</button>
      <button class="settings-button settings-button-primary" id="saveSettings">Save Settings</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
  <span id="toastMessage"></span>
</div>

<script>
// Global Variables
let allChats = [];
let selectedChatId = null;
let isLoading = false;
let settings = {
  darkMode: true,
  typingAnimation: true,
  soundEnabled: false,
  responseLength: 'medium',
  fontSize: '16px'
};

// DOM Elements
const elements = {
  splashScreen: document.getElementById('splashScreen'),
  sidebar: document.getElementById('sidebar'),
  sidebarOverlay: document.getElementById('sidebarOverlay'),
  mobileMenuBtn: document.getElementById('mobileMenuBtn'),
  newChatBtn: document.getElementById('newChatBtn'),
  settingsBtn: document.getElementById('settingsBtn'),
  chatContainer: document.getElementById('chatContainer'),
  welcomeScreen: document.getElementById('welcomeScreen'),
  messageInput: document.getElementById('messageInput'),
  sendBtn: document.getElementById('sendBtn'),
  settingsModal: document.getElementById('settingsModal'),
  closeSettings: document.getElementById('closeSettings'),
  modelSelectBtn: document.getElementById('modelSelectBtn'),
  modelSelectorModal: document.getElementById('modelSelectorModal'),
  searchInput: document.getElementById('searchInput'),
  chatHistory: document.getElementById('chatHistory'),
  toast: document.getElementById('toast'),
  toastMessage: document.getElementById('toastMessage'),
  clearChatBtn: document.getElementById('clearChatBtn'),
  exportChatBtn: document.getElementById('exportChatBtn')
};

// Initialize App
document.addEventListener('DOMContentLoaded', () => {
  // Hide splash screen after shorter delay, or on click
  const hideSplash = () => {
    elements.splashScreen.classList.add('fade-out');
    setTimeout(() => {
      elements.splashScreen.classList.add('hidden');
    }, 500);
  };
  
  // Auto-hide after 1.5 seconds
  setTimeout(hideSplash, 1500);
  
  // Allow clicking to skip
  elements.splashScreen.addEventListener('click', hideSplash);
  
  // Also hide on any key press
  document.addEventListener('keydown', hideSplash, { once: true });
  
  loadSettings();
  loadChats();
  setupEventListeners();
  
  if (allChats.length === 0) {
    createNewChat();
  } else {
    selectedChatId = localStorage.getItem('ajstudioz-lastChatId') || allChats[0].id;
    if (!allChats.find(chat => chat.id === selectedChatId)) {
      selectedChatId = allChats[0].id;
    }
  }
  
  renderChatHistory();
  renderMessages();
});

// Setup Event Listeners
function setupEventListeners() {
  // Mobile menu
  elements.mobileMenuBtn.addEventListener('click', toggleSidebar);
  elements.sidebarOverlay.addEventListener('click', closeSidebar);
  
  // Chat actions
  elements.newChatBtn.addEventListener('click', createNewChat);
  elements.clearChatBtn.addEventListener('click', clearCurrentChat);
  elements.exportChatBtn.addEventListener('click', exportCurrentChat);
  
  // Settings
  elements.settingsBtn.addEventListener('click', () => showModal(elements.settingsModal));
  elements.closeSettings.addEventListener('click', () => hideModal(elements.settingsModal));
  
  // Model selector
  elements.modelSelectBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleModelSelector();
  });
  
  // Message input
  elements.sendBtn.addEventListener('click', sendMessage);
  elements.messageInput.addEventListener('keydown', handleInputKeydown);
  elements.messageInput.addEventListener('input', autoResizeTextarea);
  
  // Search
  elements.searchInput.addEventListener('input', handleSearchInput);
  
  // Model selection
  document.querySelectorAll('.model-modal-option').forEach(option => {
    option.addEventListener('click', () => {
      selectModel(option.dataset.model, option.dataset.name);
      hideModelSelector();
    });
  });
  
  // Settings toggles
  setupSettingsEventListeners();
  
  // Click outside handlers
  document.addEventListener('click', handleGlobalClick);
  window.addEventListener('resize', handleWindowResize);
}

// Settings Event Listeners
function setupSettingsEventListeners() {
  document.getElementById('darkModeToggle').addEventListener('click', () => {
    settings.darkMode = !settings.darkMode;
    updateToggle('darkModeToggle', settings.darkMode);
    applySettings();
  });
  
  document.getElementById('typingToggle').addEventListener('click', () => {
    settings.typingAnimation = !settings.typingAnimation;
    updateToggle('typingToggle', settings.typingAnimation);
  });
  
  document.getElementById('soundToggle').addEventListener('click', () => {
    settings.soundEnabled = !settings.soundEnabled;
    updateToggle('soundToggle', settings.soundEnabled);
  });
  
  document.getElementById('saveSettings').addEventListener('click', saveSettings);
  document.getElementById('resetSettings').addEventListener('click', resetSettings);
}

// Utility Functions
function generateId() {
  return 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function formatTimestamp() {
  return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function formatDate() {
  return new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Chat Management
function createNewChat() {
  const newChat = {
    id: generateId(),
    title: "New Conversation",
    date: formatDate(),
    model: getCurrentModel(),
    messages: []
  };
  
  allChats.unshift(newChat);
  selectedChatId = newChat.id;
  saveChats();
  renderChatHistory();
  renderMessages();
  showToast('New conversation started', 'success');
}

function switchChat(chatId) {
  if (selectedChatId === chatId) return;
  
  selectedChatId = chatId;
  localStorage.setItem('ajstudioz-lastChatId', selectedChatId);
  renderChatHistory();
  renderMessages();
  
  const chat = getCurrentChat();
  if (chat) {
    updateModelSelector(chat.model);
    showToast(`Switched to: ${chat.title}`, 'info');
  }
}

function deleteChat(chatId) {
  if (!confirm('Are you sure you want to delete this conversation?')) return;
  
  allChats = allChats.filter(chat => chat.id !== chatId);
  
  if (selectedChatId === chatId) {
    selectedChatId = allChats.length > 0 ? allChats[0].id : null;
    if (!selectedChatId) {
      createNewChat();
      return;
    }
  }
  
  saveChats();
  renderChatHistory();
  renderMessages();
  showToast('Conversation deleted', 'success');
}

function clearCurrentChat() {
  const chat = getCurrentChat();
  if (!chat) return;
  
  if (!confirm('Are you sure you want to clear this conversation?')) return;
  
  chat.messages = [];
  saveChats();
  renderMessages();
  showToast('Conversation cleared', 'success');
}

function exportCurrentChat() {
  const chat = getCurrentChat();
  if (!chat || chat.messages.length === 0) {
    showToast('No messages to export', 'warning');
    return;
  }
  
  const exportData = {
    title: chat.title,
    date: chat.date,
    model: chat.model,
    messages: chat.messages.map(msg => ({
      sender: msg.sender,
      text: msg.text,
      timestamp: msg.timestamp
    }))
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `${chat.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
  link.click();
  
  URL.revokeObjectURL(url);
  showToast('Chat exported successfully', 'success');
}

// Message Management
async function sendMessage() {
  const message = elements.messageInput.value.trim();
  if (!message || isLoading) return;
  
  const chat = getCurrentChat();
  if (!chat) {
    showToast('No active chat. Please start a new conversation.', 'error');
    return;
  }
  
  // Update chat title if it's the first message
  if (chat.messages.length === 0 && chat.title === "New Conversation") {
    chat.title = message.substring(0, 40) + (message.length > 40 ? "..." : "");
    renderChatHistory();
  }
  
  // Add user message
  chat.messages.push({
    id: generateId(),
    sender: 'user',
    text: message,
    timestamp: formatTimestamp()
  });
  
  saveChats();
  renderMessages();
  
  elements.messageInput.value = '';
  autoResizeTextarea();
  elements.sendBtn.disabled = true;
  isLoading = true;
  
  // Show typing indicator
  const typingIndicator = createTypingIndicator(chat.model);
  
  try {
    const response = await fetchAIResponse(message, chat);
    
    removeTypingIndicator();
    
    if (response) {
      const aiMessage = {
        id: generateId(),
        sender: 'ai',
        text: response.text,
        timestamp: formatTimestamp(),
        aiType: chat.model,
        suggestions: response.suggestions || []
      };
      
      chat.messages.push(aiMessage);
      saveChats();
      
      if (settings.typingAnimation) {
        await renderTypingMessage(aiMessage);
      } else {
        renderMessages();
      }
    }
    
  } catch (error) {
    removeTypingIndicator();
    console.error('Error sending message:', error);
    
    const errorMessage = {
      id: generateId(),
      sender: 'ai',
      text: `Sorry, I encountered an error while processing your request. Please try again later. Error: ${error.message}`,
      timestamp: formatTimestamp(),
      aiType: chat.model,
      suggestions: []
    };
    
    chat.messages.push(errorMessage);
    saveChats();
    renderMessages();
    showToast('Failed to get AI response', 'error');
    
  } finally {
    elements.sendBtn.disabled = false;
    isLoading = false;
    elements.messageInput.focus();
  }
}

// AI Response Simulation (Replace with actual API calls)
async function fetchAIResponse(message, chat) {
  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
  
  // Simulate different responses based on model
  const responses = {
    grok: generateGrokResponse(message),
    gemini: generateGeminiResponse(message)
  };
  
  return responses[chat.model] || responses.grok;
}

function generateGrokResponse(message) {
  if (message.toLowerCase().includes('code') || message.toLowerCase().includes('python')) {
    return {
      text: `Here's a Python example for you:

\`\`\`python
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# Example usage
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")
\`\`\`

This is a simple recursive implementation of the Fibonacci sequence. Would you like me to explain how it works or show you an optimized version?`,
      suggestions: [
        "Explain the Fibonacci sequence",
        "Show an optimized version",
        "Create an iterative solution"
      ]
    };
  }
  
  if (message.toLowerCase().includes('quantum')) {
    return {
      text: `Quantum computing is a fascinating field! Here's a simple explanation:

**Key Concepts:**
- **Qubits**: Unlike classical bits (0 or 1), qubits can be in multiple states simultaneously
- **Superposition**: A qubit can be both 0 and 1 at the same time
- **Entanglement**: Qubits can be connected in ways that measuring one instantly affects another
- **Quantum Gates**: Operations that manipulate qubits

**Applications:**
- Cryptography and security
- Drug discovery and molecular modeling  
- Financial modeling
- Machine learning optimization

The power comes from quantum computers being able to process many possibilities simultaneously, potentially solving certain problems exponentially faster than classical computers.`,
      suggestions: [
        "Explain quantum entanglement",
        "How do quantum algorithms work?",
        "What are quantum computers used for today?"
      ]
    };
  }
  
  return {
    text: `I understand you're asking about "${message}". As AJ-GPT Flash, I'm designed to provide quick and comprehensive responses. Let me help you with that!

This is a demonstration response from the Flash model. In a real implementation, I would process your query and provide detailed, contextual answers based on the latest training data and capabilities.

Is there anything specific you'd like me to elaborate on or any follow-up questions you have?`,
    suggestions: [
      "Tell me more about this topic",
      "Give me examples",
      "How does this compare to other approaches?"
    ]
  };
}

function generateGeminiResponse(message) {
  return {
    text: `Thanks for your question about "${message}". I'm AJ-GPT Mini, optimized for efficiency and concise responses.

Here's what I can tell you: This is a simulated response demonstrating the Mini model's capabilities. In practice, I would provide focused, resource-efficient answers while maintaining accuracy and helpfulness.

Would you like a more detailed explanation of any particular aspect?`,
    suggestions: [
      "Explain in more detail",
      "Give me a simple example",
      "What are the practical applications?"
    ]
  };
}

// UI Rendering Functions
function renderChatHistory() {
  elements.chatHistory.innerHTML = '';
  
  allChats.forEach(chat => {
    const item = document.createElement('div');
    item.classList.add('chat-history-item');
    if (chat.id === selectedChatId) {
      item.classList.add('active');
    }
    
    item.innerHTML = `
      <div>
        <div class="chat-history-title">${escapeHtml(chat.title)}</div>
        <div class="chat-history-date">${chat.date}</div>
      </div>
      <button class="chat-delete-btn" onclick="event.stopPropagation(); deleteChat('${chat.id}')">
        <i class="fas fa-trash"></i>
      </button>
    `;
    
    item.addEventListener('click', () => switchChat(chat.id));
    elements.chatHistory.appendChild(item);
  });
}

function renderMessages() {
  const chat = getCurrentChat();
  
  if (!chat || chat.messages.length === 0) {
    elements.welcomeScreen.style.display = 'block';
    elements.chatContainer.innerHTML = '';
    elements.chatContainer.appendChild(elements.welcomeScreen);
    return;
  }
  
  elements.welcomeScreen.style.display = 'none';
  elements.chatContainer.innerHTML = '';
  
  chat.messages.forEach((message, index) => {
    const messageElement = createMessageElement(message, index);
    elements.chatContainer.appendChild(messageElement);
  });
  
  // Apply syntax highlighting
  if (typeof Prism !== 'undefined') {
    Prism.highlightAll();
  }
  
  scrollToBottom();
}

function createMessageElement(message, index) {
  const messageDiv = document.createElement('div');
  messageDiv.classList.add('message', message.sender);
  if (message.sender === 'ai') {
    messageDiv.classList.add(message.aiType);
  }
  
  const avatar = document.createElement('div');
  avatar.classList.add('message-avatar');
  avatar.textContent = getAvatarText(message);
  messageDiv.appendChild(avatar);
  
  const content = document.createElement('div');
  content.classList.add('message-content');
  
  const text = document.createElement('div');
  text.classList.add('message-text');
  text.innerHTML = processMessageText(message.text);
  content.appendChild(text);
  
  // Add follow-up suggestions for AI messages
  if (message.sender === 'ai' && message.suggestions && message.suggestions.length > 0) {
    const suggestionsDiv = document.createElement('div');
    suggestionsDiv.classList.add('follow-up-suggestions');
    
    const suggestionsTitle = document.createElement('div');
    suggestionsTitle.classList.add('follow-up-title');
    suggestionsTitle.textContent = 'Follow-up suggestions:';
    suggestionsDiv.appendChild(suggestionsTitle);
    
    const suggestionsChips = document.createElement('div');
    suggestionsChips.classList.add('follow-up-chips');
    
    message.suggestions.forEach(suggestion => {
      const chip = document.createElement('div');
      chip.classList.add('follow-up-chip');
      chip.textContent = suggestion;
      chip.addEventListener('click', () => {
        elements.messageInput.value = suggestion;
        elements.messageInput.focus();
        autoResizeTextarea();
        sendMessage();
      });
      suggestionsChips.appendChild(chip);
    });
    
    suggestionsDiv.appendChild(suggestionsChips);
    content.appendChild(suggestionsDiv);
  }
  
  if (message.sender === 'ai') {
    const actions = createMessageActions(message, index);
    content.appendChild(actions);
  }
  
  messageDiv.appendChild(content);
  return messageDiv;
}

function createMessageActions(message, index) {
  const actions = document.createElement('div');
  actions.classList.add('message-actions');
  
  const copyAction = document.createElement('div');
  copyAction.classList.add('message-action');
  copyAction.innerHTML = '<i class="fas fa-copy"></i> Copy';
  copyAction.addEventListener('click', () => copyToClipboard(message.text));
  actions.appendChild(copyAction);
  
  const regenerateAction = document.createElement('div');
  regenerateAction.classList.add('message-action');
  regenerateAction.innerHTML = '<i class="fas fa-redo"></i> Regenerate';
  regenerateAction.addEventListener('click', () => regenerateResponse(index));
  actions.appendChild(regenerateAction);
  
  return actions;
}

function createTypingIndicator(modelType) {
  const typingDiv = document.createElement('div');
  typingDiv.classList.add('typing-indicator');
  typingDiv.id = 'typingIndicator';
  
  const avatar = document.createElement('div');
  avatar.classList.add('typing-ai-avatar', modelType);
  avatar.textContent = modelType === 'grok' ? 'F' : 'M';
  typingDiv.appendChild(avatar);
  
  const text = document.createElement('span');
  text.textContent = 'AI is thinking';
  typingDiv.appendChild(text);
  
  const dots = document.createElement('div');
  dots.classList.add('typing-dots');
  for (let i = 0; i < 3; i++) {
    const dot = document.createElement('div');
    dot.classList.add('typing-dot');
    dots.appendChild(dot);
  }
  typingDiv.appendChild(dots);
  
  elements.chatContainer.appendChild(typingDiv);
  scrollToBottom();
  return typingDiv;
}

function removeTypingIndicator() {
  const indicator = document.getElementById('typingIndicator');
  if (indicator) {
    indicator.remove();
  }
}

async function renderTypingMessage(message) {
  removeTypingIndicator();
  
  const messageElement = createMessageElement(message, getCurrentChat().messages.length - 1);
  elements.chatContainer.appendChild(messageElement);
  
  const textElement = messageElement.querySelector('.message-text');
  const originalText = message.text;
  
  textElement.innerHTML = '';
  
  let displayedText = '';
  const words = originalText.split(' ');
  
  for (let i = 0; i < words.length; i++) {
    displayedText += (i > 0 ? ' ' : '') + words[i];
    textElement.innerHTML = processMessageText(displayedText);
    
    // Apply syntax highlighting for code blocks
    if (displayedText.includes('```')) {
      if (typeof Prism !== 'undefined') {
        Prism.highlightAllUnder(textElement);
      }
    }
    
    scrollToBottom();
    
    const delay = Math.min(50, Math.max(10, 100 - words[i].length * 2));
    await new Promise(resolve => setTimeout(resolve, delay));
  }
  
  // Final syntax highlighting
  if (typeof Prism !== 'undefined') {
    setTimeout(() => Prism.highlightAll(), 100);
  }
}

// Text Processing Functions
function processMessageText(text) {
  let processed = text;
  
  // Handle code blocks
  processed = processed.replace(/```(\w+)?\n?([\s\S]*?)```/g, (match, language, code) => {
    const lang = language || 'text';
    const trimmedCode = code.trim();
    const isPreviewable = ['html', 'css', 'javascript', 'js'].includes(lang.toLowerCase());
    
    return `
      <div class="code-block">
        <div class="code-header">
          <div class="code-language">${lang}</div>
          <div class="code-actions">
            <button class="copy-code-btn" onclick="copyCode(this)">
              <i class="fas fa-copy"></i> Copy
            </button>
            ${isPreviewable ? `
              <button class="preview-btn" onclick="previewCode(this, '${lang.toLowerCase()}')">
                <i class="fas fa-eye"></i> Preview
              </button>
            ` : ''}
            ${lang.toLowerCase() === 'javascript' || lang.toLowerCase() === 'js' ? `
              <button class="run-code-btn" onclick="runCode(this)">
                <i class="fas fa-play"></i> Run
              </button>
            ` : ''}
          </div>
        </div>
        <div class="code-content">
          <pre><code class="language-${lang}">${escapeHtml(trimmedCode)}</code></pre>
        </div>
      </div>
    `;
  });
  
  // Handle inline code
  processed = processed.replace(/`([^`\n]+)`/g, '<code>$1</code>');
  
  // Handle markdown formatting
  processed = processed
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/\n/g, '<br>');
  
  return processed;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Code Interaction Functions
function copyCode(button) {
  const codeBlock = button.closest('.code-block');
  const code = codeBlock.querySelector('code').textContent;
  copyToClipboard(code);
}

function previewCode(button, language) {
  const codeBlock = button.closest('.code-block');
  const code = codeBlock.querySelector('code').textContent;
  
  let existingPreview = codeBlock.querySelector('.code-preview');
  if (existingPreview) {
    existingPreview.remove();
    button.innerHTML = '<i class="fas fa-eye"></i> Preview';
    return;
  }
  
  let htmlContent = '';
  
  if (language === 'html') {
    htmlContent = code;
  } else if (language === 'css') {
    htmlContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <style>${code}</style>
      </head>
      <body>
        <div class="preview-content">CSS Preview</div>
      </body>
      </html>
    `;
  } else if (language === 'javascript' || language === 'js') {
    htmlContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
          #output { background: white; padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid #ddd; }
        </style>
      </head>
      <body>
        <h3>JavaScript Output</h3>
        <div id="output"></div>
        <script>
          const originalLog = console.log;
          console.log = function(...args) {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.textContent = args.join(' ');
            div.style.marginBottom = '8px';
            output.appendChild(div);
            originalLog.apply(console, args);
          };
          
          try {
            ${code}
          } catch (error) {
            const output = document.getElementById('output');
            output.innerHTML = '<div style="color: red;">Error: ' + error.message + '</div>';
          }
        </script>
      </body>
      </html>
    `;
  }
  
  const previewDiv = document.createElement('div');
  previewDiv.className = 'code-preview';
  previewDiv.innerHTML = `
    <iframe srcdoc="${escapeHtml(htmlContent)}" sandbox="allow-scripts" style="width: 100%; height: 300px; border: none; background: white; border-radius: 0 0 8px 8px;"></iframe>
  `;
  
  codeBlock.appendChild(previewDiv);
  button.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Preview';
  showToast('Code preview generated', 'success');
}

function runCode(button) {
  const codeBlock = button.closest('.code-block');
  const code = codeBlock.querySelector('code').textContent;
  
  try {
    const result = new Function(code)();
    if (result !== undefined) {
      showToast(`Output: ${result}`, 'success');
    } else {
      showToast('Code executed successfully', 'success');
    }
  } catch (error) {
    showToast(`Error: ${error.message}`, 'error');
  }
}

// Utility Functions
function getCurrentChat() {
  return allChats.find(chat => chat.id === selectedChatId);
}

function getCurrentModel() {
  const activeOption = document.querySelector('.model-modal-option.active');
  return activeOption ? activeOption.dataset.model : 'grok';
}

function getAvatarText(message) {
  if (message.sender === 'user') return 'U';
  if (message.aiType === 'grok') return 'F';
  if (message.aiType === 'gemini') return 'M';
  return 'AI';
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    showToast('Copied to clipboard', 'success');
  }).catch(() => {
    showToast('Failed to copy to clipboard', 'error');
  });
}

function quickPrompt(text) {
  elements.messageInput.value = text;
  elements.messageInput.focus();
  autoResizeTextarea();
  sendMessage();
}

async function regenerateResponse(messageIndex) {
  const chat = getCurrentChat();
  if (!chat || messageIndex <= 0 || messageIndex >= chat.messages.length) return;
  
  const aiMessage = chat.messages[messageIndex];
  if (aiMessage.sender !== 'ai') return;
  
  const userMessage = chat.messages[messageIndex - 1];
  if (!userMessage || userMessage.sender !== 'user') return;
  
  // Remove the AI response and any subsequent messages
  chat.messages = chat.messages.slice(0, messageIndex);
  saveChats();
  renderMessages();
  
  // Regenerate response
  elements.messageInput.value = userMessage.text;
  sendMessage();
}

// Event Handlers
function handleInputKeydown(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function handleSearchInput(e) {
  const searchTerm = e.target.value.toLowerCase();
  const chatItems = elements.chatHistory.querySelectorAll('.chat-history-item');
  
  chatItems.forEach(item => {
    const title = item.querySelector('.chat-history-title').textContent.toLowerCase();
    item.style.display = title.includes(searchTerm) ? 'flex' : 'none';
  });
}

function handleGlobalClick(e) {
  if (!elements.modelSelectBtn.contains(e.target) && !elements.modelSelectorModal.contains(e.target)) {
    hideModelSelector();
  }
  
  if (e.target === elements.settingsModal) {
    hideModal(elements.settingsModal);
  }
}

function handleWindowResize() {
  if (window.innerWidth > 768) {
    closeSidebar();
  }
}

function autoResizeTextarea() {
  const textarea = elements.messageInput;
  textarea.style.height = 'auto';
  textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
}

// UI Control Functions
function toggleSidebar() {
  elements.sidebar.classList.toggle('open');
  elements.sidebarOverlay.classList.toggle('show');
}

function closeSidebar() {
  elements.sidebar.classList.remove('open');
  elements.sidebarOverlay.classList.remove('show');
}

function showModal(modal) {
  modal.style.display = 'flex';
}

function hideModal(modal) {
  modal.style.display = 'none';
}

function toggleModelSelector() {
  const isVisible = elements.modelSelectorModal.style.display === 'block';
  elements.modelSelectorModal.style.display = isVisible ? 'none' : 'block';
}

function hideModelSelector() {
  elements.modelSelectorModal.style.display = 'none';
}

function selectModel(model, name) {
  const chat = getCurrentChat();
  if (chat) {
    chat.model = model;
    saveChats();
  }
  
  updateModelSelector(model);
  showToast(`Selected: ${name}`, 'info');
}

function updateModelSelector(model) {
  document.querySelectorAll('.model-modal-option').forEach(option => {
    option.classList.toggle('active', option.dataset.model === model);
  });
}

function updateToggle(toggleId, isActive) {
  const toggle = document.getElementById(toggleId);
  toggle.classList.toggle('active', isActive);
}

function scrollToBottom() {
  elements.chatContainer.scrollTop = elements.chatContainer.scrollHeight;
}

function showToast(message, type = 'info') {
  elements.toastMessage.textContent = message;
  elements.toast.className = `toast show ${type}`;
  
  if (settings.soundEnabled) {
    playNotificationSound(type);
  }
  
  setTimeout(() => {
    elements.toast.className = 'toast';
  }, 3000);
}

function playNotificationSound(type) {
  try {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.type = 'sine';
    oscillator.frequency.value = type === 'error' ? 300 : 600;
    gainNode.gain.value = 0.1;
    
    oscillator.start();
    oscillator.stop(audioContext.currentTime + 0.1);
  } catch (error) {
    console.log('Audio not available');
  }
}

// Settings Management
function loadSettings() {
  const saved = localStorage.getItem('ajstudioz-settings');
  if (saved) {
    settings = { ...settings, ...JSON.parse(saved) };
  }
  applySettings();
  updateSettingsUI();
}

function saveSettings() {
  settings.responseLength = document.getElementById('responseLength').value;
  settings.fontSize = document.getElementById('fontSize').value;
  
  localStorage.setItem('ajstudioz-settings', JSON.stringify(settings));
  applySettings();
  hideModal(elements.settingsModal);
  showToast('Settings saved successfully', 'success');
}

function resetSettings() {
  if (!confirm('Reset all settings to default?')) return;
  
  settings = {
    darkMode: true,
    typingAnimation: true,
    soundEnabled: false,
    responseLength: 'medium',
    fontSize: '16px'
  };
  
  localStorage.removeItem('ajstudioz-settings');
  applySettings();
  updateSettingsUI();
  hideModal(elements.settingsModal);
  showToast('Settings reset to default', 'info');
}

function applySettings() {
  document.documentElement.style.fontSize = settings.fontSize;
  document.body.classList.toggle('dark-mode', settings.darkMode);
}

function updateSettingsUI() {
  updateToggle('darkModeToggle', settings.darkMode);
  updateToggle('typingToggle', settings.typingAnimation);
  updateToggle('soundToggle', settings.soundEnabled);
  
  document.getElementById('responseLength').value = settings.responseLength;
  document.getElementById('fontSize').value = settings.fontSize;
}

// Data Management
function loadChats() {
  const saved = localStorage.getItem('ajstudioz-chats');
  if (saved) {
    allChats = JSON.parse(saved);
  }
}

function saveChats() {
  localStorage.setItem('ajstudioz-chats', JSON.stringify(allChats));
  if (selectedChatId) {
    localStorage.setItem('ajstudioz-lastChatId', selectedChatId);
  }
}
</script>

</body>
</html>
